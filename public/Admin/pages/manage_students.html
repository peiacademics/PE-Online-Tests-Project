<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<head>
	<meta charset="utf-8" />
	<title>Manage Students</title>
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
	<meta content="" name="description" />
	<meta content="" name="author" />
	
	<!-- ================== BEGIN BASE CSS STYLE ================== -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
	<link href="../../assets/plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet" />
	<link href="../../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
	<link href="../../assets/plugins/animate/animate.min.css" rel="stylesheet" />
	<link href="../../assets/css/default/style.min.css" rel="stylesheet" />
	<link href="../../assets/css/default/style-responsive.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<link href="../../assets/css/default/theme/default.css" rel="stylesheet" />
	<!-- ================== END BASE CSS STYLE ================== -->
	<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- ================== BEGIN BASE JS ================== -->
	<script src="../../assets/plugins/pace/pace.min.js"></script>
	<!-- ================== END BASE JS ================== -->
	<style>
	.delete-student{
		font-size:1.8em;
		float:right;
		color:red;
	}
	.delete-student:hover{
		color:black;
		cursor: pointer;
	}
    .student{
        width:100%;
        padding:10px;
        height:150px;
        box-shadow:0px 0px 3px 0.2px black;
         }

    .inline{
        display: inline-block;
    }
    .inliner{
        display: inline-block;
        float:right;
    }
	.card-header{
		box-shadow: 0px 0px 2px 0px black;
	}
	.card-body{
		height:wrap;
		background-color:#2f3542;
		box-shadow: 0px 0px 2px 0px black;
	}
	.col-md-1{
		margin:5px;
	}
	.student-contact-details {
		opacity:1;
	}
	.delete-icon-button {
		color:red;
	}
	.delete-icon-button:hover{
		cursor: pointer;
	}
	</style>
</head>
<body>
	<script>
	

	</script>
	<!-- begin #page-loader -->
	<div id="page-loader" class="fade show"><span class="spinner"></span></div>
	<!-- end #page-loader -->
	
	<!-- begin #page-container -->
	<div id="page-container" class="fade page-sidebar-fixed page-header-fixed">
		<!-- begin #header -->
		<div id="header" class="header navbar-default">
			<!-- begin navbar-header -->
			<div class="navbar-header">
				<a  class="navbar-brand"><span ></span> <b>PE</b> Tests Admin.</a>
				<button type="button" class="navbar-toggle" data-click="sidebar-toggled">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			<!-- end navbar-header -->
			
			<!-- begin header-nav -->
			<ul class="navbar-nav navbar-right">
				<li>
					<form class="navbar-form">
						<div class="form-group">
							<input type="text" class="form-control" placeholder="Enter keyword" />
							<button type="submit" class="btn btn-search"><i class="fa fa-search"></i></button>
						</div>
					</form>
				</li>
				
				<li class="dropdown navbar-user">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown">
						<div class="image image-icon bg-black text-grey-darker">
						<img src="../PE_Resources/paathshala_logo_512.png">
						</div>
						<span id="navbarNameHolder"></span>
					</a>
					<div class="dropdown-menu dropdown-menu-right">
						<a href="#" id="logoutButton" class="dropdown-item" style="cursor: pointer;" >Log Out</a>
					</div>
				</li>
			</ul>
			<!-- end header navigation right -->
		</div>
		<!-- end #header -->
		
		<!-- begin #sidebar -->
		<div id="sidebar" class="sidebar">
			<!-- begin sidebar scrollbar -->
			<div data-scrollbar="true" data-height="100%">
				<!-- begin sidebar user -->
				<ul class="nav">
					<li class="nav-profile">
						<a href="javascript:;" data-toggle="nav-profile">
							<div class="cover with-shadow"></div>
							<div class="info">
								<p id="sidebarNameHolder"></p>
								<small>PE Admin</small>
							</div>
						</a>
					</li>

				
				</ul>
				<!-- end sidebar user -->
				<!-- begin sidebar nav -->
				<ul class="nav">
					<li class="nav-header">Navigation</li>
					<li>
						<a href="./dashboard.html">
							<i class="fa fa-th-large"></i>
							<span>Home</span>
						</a>
					</li>
					<li class="has-sub ">
						<a href="javascript:;">
							<i class="fa fa-user" aria-hidden="true"></i>
							<span>Admin Settings</span>
						</a>
						<ul class="sub-menu">
							<li><a href="./create_admin.html">Create Admin</a></li>
							<li><a href="./manage_admins.html">Manage Admin</a></li>
						</ul>
                    </li>
                    <li class="has-sub active">
						<a href="javascript:;">
							<i class="fa fa-graduation-cap" aria-hidden="true"></i>
							<span>Student Settings</span>
						</a>
						<ul class="sub-menu">
							<li><a href="./register_student.html">Register Student</a></li>
							<li class="active"><a href="#">Manage Students</a></li>
						</ul>
					</li>
					<li>
						<a href="./manage_syllabus.html">
							<i class="fa fa-book" aria-hidden="true"></i>
							<span>Syllabus Manager</span>
						</a>
					</li>
					<li class="has-sub">
						<a href="javascript:;">
							<i class="fa fa-plus-circle" aria-hidden="true"></i>
							<span>Create NEET Tests</span>
						</a>
						<ul class="sub-menu">
							<li><a href="./create_neet_fst.html"> FST Test</a></li>
							<li><a href="./create_neet_cwt.html"> CWT Test</a></li>
							<li><a href="./create_neet_swt.html"> SWT Test</a></li>
						</ul>
					</li>
					<li class="has-sub">
						<a href="javascript:;">
							<i class="fa fa-plus-circle" aria-hidden="true"></i>
							<span>Create JEE MAINS Tests</span>
						</a>
						<ul class="sub-menu">
							<li><a href="./create_jee_mains_fst.html"> FST Test</a></li>
							<li><a href="./create_jee_mains_cwt.html"> CWT Test</a></li>
							<li><a href="./create_jee_mains_swt.html"> SWT Test</a></li>
						</ul>
					</li>
					<li class="has-sub">
						<a href="javascript:;">
							<i class="fa fa-plus-circle" aria-hidden="true"></i>
							<span>Create JEE ADVANCED Tests</span>
						</a>
						<ul class="sub-menu">
							<li><a href="./create_jee_advanced_fst.html"> FST Test</a></li>
							<li><a href="./create_jee_advanced_cwt.html"> CWT Test</a></li>
							<li><a href="./create_jee_advanced_swt.html"> SWT Test</a></li>
						</ul>
					</li>
					<li class="has-sub">
						<a href="javascript:;">
							<i class="fa fa-plus-circle" aria-hidden="true"></i>
							<span>Create STATE BOARD Tests</span>
						</a>
						<ul class="sub-menu">
							<li><a href="./create_state_board_fst.html"> FST Test</a></li>
							<li><a href="./create_state_board_cwt.html"> CWT Test</a></li>
							<li><a href="./create_state_board_swt.html"> SWT Test</a></li>
						</ul>
					</li>
					<li class="has-sub">
						<a href="javascript:;">
						<i class="fa fa-pencil" aria-hidden="true"></i>
						<span> Modify Tests </span>
						</a>
						<ul class="sub-menu">
							<li><a href="./modify_fst.html">Modify FST Tests</a></li>
							<li><a href="./modify_cwt.html">Modify CWT Tests</a></li>
							<li><a href="./modify_swt.html">Modify SWT Tests</a></li>
						</ul>
					</li>
					<!-- menu 2-->

					<!-- begin sidebar minify button -->
					<li><a href="javascript:;" class="sidebar-minify-btn" data-click="sidebar-minify"><i class="fa fa-angle-double-left"></i></a></li>
					<!-- end sidebar minify button -->
				</ul>
				<!-- end sidebar nav -->
			</div>
			<!-- end sidebar scrollbar -->
		</div>
		<div class="sidebar-bg"></div>
		<!-- end #sidebar -->
		
		<!-- begin #content -->
		<div id="content" class="content">
			<!-- begin breadcrumb -->
			<ol class="breadcrumb pull-right">
                <li class="breadcrumb-item"><a href="#">Student Settings</a></li>
                <li class="breadcrumb-item active"><a href="#">Manage Students</a></li>

			</ol>
			<!-- end breadcrumb -->
            <!-- begin page-header -->
            <h1 class="page-header">Manage Students</h1>
			<!-- end page-header -->
			<div class="panel panel-inverse">
					<div class="panel-heading">
						<div class="panel-heading-btn">
						</div>
						<h4 class="panel-title">Students</h4>
					</div>
					<div class="panel-body" id="student-list-view">
						
					</div>
					<!-- Add Packs Model -->
					<div id="addPackModal" class="modal fade" role="dialog">
						<div class="modal-dialog">
					  
						  <!-- Modal content-->
						  <div class="modal-content">
							<div class="modal-header">
							  <button type="button" class="close" data-dismiss="modal">&times;</button>
							  <h4 class="modal-title">Add Pack</h4> 
							</div>
							<div class="modal-body">
							  <h3> Select Pack </h3>
							  <select style="height:200px" class="form-line" id="packToAdd" multiple style="height:30px;width:265px;border-radius:5px;padding:5px;font-weight:bold;margin-top:5px">
								<option value="JEE_MAINS_P" >JEE MAINS PHYSICS (JEE_MAINS_P)</option>
								<option  value="JEE_MAINS_C" >JEE MAINS CHEMISTRY (JEE_MAINS_C)</option>
								<option value="JEE_MAINS_M" >JEE MAINS MATHS (JEE_MAINS_M)</option>         
								<option value="JEE_MAINS_PCM" >JEE MAINS PCM</option>        
								<option" value="JEE_ADVANCED_P" >JEE ADVANCED PHYSICS (JEE_ADVANCED_P)</option>
								<option value="JEE_ADVANCED_C" >JEE ADVANCED CHEMISTRY (JEE_ADVANCED_C)</option> 
								<option value="JEE_ADVANCED_M" >JEE ADVANCED MATHS (JEE_ADVANCED_M)</option>
								<option value="JEE_ADVANCED_PCM" >JEE ADVANCED PCM </option>
								<option value="NEET_P" >NEET PHYSICS (NEET_P)</option>   
								<option value="NEET_C" >NEET CHEMISTRY (NEET_C)</option>
								<option value="NEET_B" >NEET BIOLOGY (NEET_B)</option>
								<option value="NEET_PCB" >NEET PCB</option>
								<option value="STATE_BOARD_P" >STATE BOARD PHYSICS (STATE_BOARD_P)</option>
								<option value="STATE_BOARD_C" >STATE BOARD CHEMISTRY (STATE_BOARD_C)</option>
								<option value="STATE_BOARD_M" >STATE BOARD MATHS (STATE_BOARD_M)</option>
								<option value="STATE_BOARD_B">TATE BOARD BIOLOGY (STATE_BOARD_B)</option>
								<option value="STATE_BOARD_PCM" >STATE BOARD PCM </option>
								<option value="STATE_BOARD_PCB" >STATE BOARD PCB </option>
							</select>
							</div>
							<div class="modal-footer">
							  <button class="btn btn-green" id="addPackButton" onclick="addPackToStudent()" >Add Pack To Student</button>
							  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
							</div>
						  </div>
					  
						</div>
					</div>
						<!-- View Packs Modal-->
						<div id="viewPackModal" class="modal fade" role="dialog">
								<div class="modal-dialog">
							  
								  <!-- Modal content-->
								  <div class="modal-content">
									<div class="modal-header">
									  <button type="button" class="close" data-dismiss="modal">&times;</button>
									  <h4 class="modal-title">View Pack</h4>
									</div>
									<div class="modal-body">
									  <h3 id='viewPacks-title'>  </h3>
									  <div id="viewPacks-packs">

									  </div>
									</div>
									<div class="modal-footer">
									  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
									</div>
								  </div>
							  
								</div>
							</div>
        
				</div>
				</div>
		<!-- end #content -->
		
		<!-- begin scroll to top btn -->
		<a href="javascript:;" class="btn btn-icon btn-circle btn-success btn-scroll-to-top fade" data-click="scroll-top"><i class="fa fa-angle-up"></i></a>
		<!-- end scroll to top btn -->
	</div>
	<!-- end page container -->
	
	<!-- ================== BEGIN BASE JS ================== -->
	<script src="../../assets/plugins/jquery/jquery-3.3.1.min.js"></script>
	<script src="../../assets/plugins/jquery-ui/jquery-ui.min.js"></script>
	<script src="../../assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
	<!--[if lt IE 9]>
		<script src="../../assets/crossbrowserjs/html5shiv.js"></script>
		<script src="../../assets/crossbrowserjs/respond.min.js"></script>
		<script src="../../../admin/template../../assets/crossbrowserjs/excanvas.min.js"></script>
	<![endif]-->
	<script src="../../assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
	<script src="../../assets/plugins/js-cookie/js.cookie.js"></script>
	<script src="../../../admin/template../../assets/js/theme/default.min.js"></script>
	<script src="../../assets/js/apps.min.js"></script>
	<!-- ================== END BASE JS ================== -->
	
	<script>
	var pe_username;
	var pe_email;
	var domain_url = "https://photonecademy.com/tests";
    var user_access_token = localStorage.getItem("admin_token");
		// Only Related To Manage Admins Page
		var student_list_view = document.getElementById("student-list-view");

		// All Nameplace holders

		// Sidebar Name Holder
		var sidebarNameHolder = document.getElementById("sidebarNameHolder");
		// Logout functionality
		var logout = document.getElementById("logoutButton");
		logout.addEventListener("click",()=>{
			localStorage.clear();
			document.location.href=`${domain_url}/admin`;

		})
		//Navbar name holder
		var navNameHolder = document.getElementById("navbarNameHolder");
	console.log("access token:-"+user_access_token)
		if(user_access_token==null)
		{
			document.location.href=`${domain_url}/admin`;

		}

		fetch(`${domain_url}/verifyAdmin`,{
			headers:{
				method:"GET",
				authorization:user_access_token
			}
		}).then(response=>response.json()).then(data=>{
			console.log("is token verified? "+data.is_verified);
			if(data.is_verified==false)
			{
				document.location.href=`${domain_url}/admin`;
			}
			if(data.is_verified==true)
			{
                var admin = data.admin;
				pe_username = admin.adminID;
				sidebarNameHolder.innerHTML=pe_username;
				navNameHolder.innerHTML=pe_username;
				fetch(`${domain_url}/getStudents`,{
					headers:{
						method:"GET",
						authorization:user_access_token
					}
				}).then(response => response.json()).then(data=>{
					if(data.is_successful)
					{
						console.log("%c Fetched Students Successfully","color:green;font-weight:bold");
						console.log(data.students);
						student_list_view.innerHTML="";
						data.students.forEach(student=>{
							student_list_view.innerHTML+=`
							    <div class="card">
									<div class="card-header">
										<h3>${student.studentID}&nbsp<span class="badge badge-primary student-contact-details" style="border-radius:0"> <i class="fa fa-envelope" aria-hidden="true"></i>&nbsp&nbsp${student.email}</span>&nbsp&nbsp<span class="badge badge-primary student-contact-details" style="border-radius:0"> <i class="fa fa-phone-square" aria-hidden="true"></i>
</i>&nbsp&nbsp${student.contact}</span>&nbsp&nbsp<button class="btn btn-danger" onclick="deleteStudent('${student.studentID}')"> Remove Student </button>
									</div>
									<div class="card-body">
										<div class="row">
											<div class="col-2">
												<button class="btn btn-light" onclick="showPacks('${student.studentID}')"> View & Remove Packs </button>
											</div>
											<div class="col-2">
												<button class="btn btn-light" onclick="changePassword('${student.studentID}')"> Change Password </button>
											</div>
											<div class="col-2">
												<button class="btn btn-light" onclick="changeEmail('${student.studentID}')"> Change E-Mail </button>
											</div>
											<div class="col-2">
												<button class="btn btn-light" onclick="changeContact('${student.studentID}')"> Change Contact </button>
											</div>
											<div class="col-2">
												<button class="btn btn-light" onclick="showAddPackModal('${student.studentID}')"> Add Packs  </button>
											</div>
											
										
								</div>
					
								`;
						})

					}
					else
					{
						console.log("%c Failed to fetch Admins :(","color:red;font-weight:bold");

					}
				})			}
		
        })
        
   
		// Functions Related To Manage Students
		function showPacks(studentID){
			var viewPackModal = document.getElementById("viewPackModal");
			$("#viewPackModal").modal();
			document.getElementById("viewPacks-title").innerHTML=`${studentID}'s Packs`
			fetch(`${domain_url}/getStudentPacks`,{
				method:"POST",
				headers:{
					authorization:user_access_token,
					'Content-Type':"application/json"
				},
				body:JSON.stringify({"studentID":studentID})
			}).then(response=>response.json()).then(data=>{
				if(data.is_successful)
				{
					console.log("%c Fetched Packs Successfully","color:green;font-weight:bold")
					console.log(data.packs);
					var viewPacksArea = document.getElementById("viewPacks-packs");
					viewPacksArea.innerHTML="";
					data.packs.forEach(pack=>{
						viewPacksArea.innerHTML+=`<h3><span class="badge badge-primary badge-dark" style="border-radius:0"> ${pack} <i class="fa fa-minus-circle delete-icon-button" onclick="removePack('${studentID}','${pack}')" aria-hidden="true"></i>
</span></h3> `
					})
					
				}
				else
				{
					console.log("%c Failed to Fetch Packs :'( ","color:red;font-weight:bold")
				}
			}) 
		}
		function deleteStudent(studentID){
			console.log(`studentID - ${studentID}`)
			fetch(`${domain_url}/deleteStudent`,{
				method:"POST",
				headers:{
				'Content-Type': 'application/json',
				authorization:user_access_token
			},
			body:JSON.stringify({"studentID":studentID})
			}).then(response=>response.json()).then(data=>{
				if(data.is_successful)
				{
					console.log("%c Successfully Deleted Student","color:green;font-weight:bold");
					window.location.reload();

				}
				else
				{
					console.log("%c Failed to Deleted Student","color:red;font-weight:bold");
					alert("Failed to Delete Student");
				}
			})
		}
		// ChangeStudent Password
		function changePassword(studentID){
			var new_password = prompt("Set New Password");
			if(new_password!=null)
			{
				console.log("%c Changing Password","color:blue;font-weight:bold")
				console.log(new_password);
			fetch(`${domain_url}/changeStudentPassword`,{
				method:"POST",
				headers:{
				authorization:user_access_token,
				'Content-Type': 'application/json'
				},
				body:JSON.stringify({"new_password":new_password,"studentID":studentID})
			}).then(response=> response.json()).then(data=>{
				if(data.is_successful)
				{
					console.log("%c Password changed successfully ","color:green;font-weight:bold");
					alert("Password Changed Successfully");
				}
				else
				{
					console.log("%c Failed to change password ","color:red;font-weight:bold");
					alert("Failed to change password");

				}
			})
		}
		}
		// ChangeStudent Email
		function changeEmail(studentID){
			var new_email = prompt("Set New Email ID");
			if(new_email!=null)
			{
				console.log("%c Changing Email","color:blue;font-weight:bold")
				console.log(new_email);
			fetch(`${domain_url}/changeStudentEmail`,{
				method:"POST",
				headers:{
				authorization:user_access_token,
				'Content-Type': 'application/json'
				},
				body:JSON.stringify({"new_email":new_email,"studentID":studentID})
			}).then(response=> response.json()).then(data=>{
				if(data.is_successful)
				{
					console.log("%c Email changed successfully ","color:green;font-weight:bold");
					alert("Email Changed Successfully");
				}
				else
				{
					console.log("%c Failed to change email ","color:red;font-weight:bold");
					alert("Failed to change email");

				}
			})
		}
		}
		// ChangeStudent Contact
		function changeContact(studentID){
			var new_contact = prompt("Set New Contact No.");
			if(new_contact!=null)
			{
				console.log("%c Changing Contact No..","color:blue;font-weight:bold")
				console.log(new_contact);
			fetch(`${domain_url}/changeStudentContact`,{
				method:"POST",
				headers:{
				authorization:user_access_token,
				'Content-Type': 'application/json'
				},
				body:JSON.stringify({"new_contact":new_contact,"studentID":studentID})
			}).then(response=> response.json()).then(data=>{
				if(data.is_successful)
				{
					console.log("%c Contact No. changed successfully ","color:green;font-weight:bold");
					alert("Contact No. Changed Successfully");
				}
				else
				{
					console.log("%c Failed to change Contact No. ","color:red;font-weight:bold");
					alert("Failed to change Contact no.");

				}
			})
		}
		}
		function removePack(studentID,pack)
		{
			fetch(`${domain_url}/removePackFromStudent`,{
				method:"POST",
				headers:{
					authorization:user_access_token,
					'Content-type':'application/json'
				},
				body:JSON.stringify({"studentID":studentID,"pack":pack})
			}).then(response=>response.json()).then(data=>{
				if(data.is_successful)
				{
					alert("Removed Pack Successfully");
					window.location.reload();
				}
				else
				{
					alert("Failed to remove Pack")
				}

			})
		}
		function showAddPackModal(studentID){
			console.log(studentID);
			var addPackModal = document.getElementById("addPackModal");
			document.getElementById("")
			$("#addPackModal").modal();
			var addPackButton = document.getElementById("addPackButton");
			addPackButton.value=studentID;
		}

		function addPackToStudent(){
			var pack = document.getElementById("packToAdd").value;
			var addPackButton = document.getElementById("addPackButton");
			console.log(`Student - ${addPackButton.value} , pack - ${pack}`)
			if(pack!=null && pack!="")
			{
				fetch(`${domain_url}/addPackToStudent`,{
					method:"POST",
					headers:{
						authorization:user_access_token,
						'Content-Type':'application/json'
					},
					body:JSON.stringify({"studentID":addPackButton.value,"pack":pack})
				}).then(response=>response.json()).then(data=>{
					if(data.is_successful)
					{
						alert("Pack Added To Student");
					}
					else
					{
						alert("Something went wrong, maybe student already has this pack, please check.");
					}
				})
			}
			else
			{
				alert("Please Select A Pack To Add");
			}
		}
		$(document).ready(function() {
			App.init();
		});
	</script>
</body>
</html>
