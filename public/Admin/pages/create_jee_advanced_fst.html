<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<head>
	<meta charset="utf-8" />
	<title>Create JEE ADVANCED FST</title>
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
	<meta content="" name="description" />
	<meta content="" name="author" />
	
	<!-- ================== BEGIN BASE CSS STYLE ================== -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
	<link href="../../assets/plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet" />
	<link href="../../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

	<link href="../../assets/plugins/animate/animate.min.css" rel="stylesheet" />
	<link href="../../assets/css/default/style.min.css" rel="stylesheet" />
	<link href="../../assets/css/default/style-responsive.min.css" rel="stylesheet" />
	<link href="../../assets/css/default/theme/default.css" rel="stylesheet" />
	<!-- ================== END BASE CSS STYLE ================== -->
	<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- ================== BEGIN BASE JS ================== -->
	<script src="../../assets/plugins/pace/pace.min.js"></script>
	<!-- ================== END BASE JS ================== -->
</head>
<style>
.add-question-btn
{
    width:46%;
    height: 50px;
    font-size: 1.5em;
    text-align: center;
    margin-left: auto;
    margin-right: auto;
}
.create-test-btn
{
	margin-top: 15px;
    width:96%;
    height: 50px;
    font-size: 1.5em;
    text-align: center;
    margin-left: auto;
    margin-right: auto;
}
.delete-question-btn
{
    width:46%;
    height: 50px;
    font-size: 1.5em;
    text-align: center;
    margin-left: auto;
    margin-right: auto;
}
.card{
    box-shadow: 1px 0px 4px 0px black;
}
.image_panel{
    width:98%;
    margin-left: auto;
    margin-right: auto;
    height:400px;
    border:5px dotted black;
}
</style>
<body>
	<script>
	

	</script>
	<!-- begin #page-loader -->
	<div id="page-loader" class="fade show"><span class="spinner"></span></div>
	<!-- end #page-loader -->
	
	<!-- begin #page-container -->
	<div id="page-container" class="fade page-sidebar-fixed page-header-fixed">
		<!-- begin #header -->
		<div id="header" class="header navbar-default">
			<!-- begin navbar-header -->
			<div class="navbar-header">
				<a  class="navbar-brand"><span ></span> <b>PE</b> Tests Admin.</a>
				<button type="button" class="navbar-toggle" data-click="sidebar-toggled">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			<!-- end navbar-header -->
			
			<!-- begin header-nav -->
			<ul class="navbar-nav navbar-right">
				<li>
					<form class="navbar-form">
						<div class="form-group">
							<input type="text" class="form-control" placeholder="Enter keyword" />
							<button type="submit"  class="btn btn-search"><i class="fa fa-search"></i></button>
						</div>
					</form>
				</li>
				
				<li class="dropdown navbar-user">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown">
						<div class="image image-icon bg-black text-grey-darker">
						<img src="../PE_Resources/paathshala_logo_512.png">
						</div>
						<span id="navbarNameHolder"></span>
					</a>
					<div class="dropdown-menu dropdown-menu-right">
						<a href="#" id="logoutButton" class="dropdown-item" style="cursor: pointer;" >Log Out</a>
					</div>
				</li>
			</ul>
			<!-- end header navigation right -->
		</div>
		<!-- end #header -->
		
		<!-- begin #sidebar -->
		<div id="sidebar" class="sidebar">
			<!-- begin sidebar scrollbar -->
			<div data-scrollbar="true" data-height="100%">
				<!-- begin sidebar user -->
				<ul class="nav">
					<li class="nav-profile">
						<a href="javascript:;" data-toggle="nav-profile">
							<div class="cover with-shadow"></div>
							<div class="info">
								<p id="sidebarNameHolder"></p>
								<small>PE Admin</small>
							</div>
						</a>
					</li>

				
				</ul>
				<!-- end sidebar user -->
				<!-- begin sidebar nav -->
				<ul class="nav">
					<li class="nav-header">Navigation</li>
					<li>
						<a href="./dashboard.html">
							<i class="fa fa-th-large"></i>
							<span>Home</span>
						</a>
					</li>
					<li class="has-sub">
						<a href="javascript:;">
							<i class="fa fa-user" aria-hidden="true"></i>
							<span>Admin Settings</span>
						</a>
						<ul class="sub-menu">
							<li><a href="./create_admin.html">Create Admins</a></li>
							<li><a href="./manage_admins.html">Manage Admins</a></li>
						</ul>
					</li>
					<li class="has-sub">
						<a href="javascript:;">
							<i class="fa fa-graduation-cap" aria-hidden="true"></i>
							<span>Student Settings</span>
						</a>
						<ul class="sub-menu">
							<li><a href="./register_student.html">Register Student</a></li>
							<li><a href="./manage_students.html">Manage Students</a></li>
						</ul>
					</li>
					<li>
						<a href="./manage_syllabus.html">
							<i class="fa fa-book" aria-hidden="true"></i>
							<span>Syllabus Manager</span>
						</a>
					</li>
					<li class="has-sub active">
						<a href="javascript:;">
							<i class="fa fa-plus-circle" aria-hidden="true"></i>
							<span>Create Tests</span>
						</a>
						<ul class="sub-menu">
							<li class="has-sub">
								<a href="javascript:;">
									<i class="fa fa-plus-circle" aria-hidden="true"></i>
									<span>Create NEET Tests</span>
								</a>
								<ul class="sub-menu">
									<li><a href="./create_neet_fst.html"> FST Test</a></li>
									<li><a href="./create_neet_cwt.html"> CWT Test</a></li>
									<li><a href="./create_neet_swt.html"> SWT Test</a></li>
								</ul>
							</li>
							<li class="has-sub">
								<a href="javascript:;">
									<i class="fa fa-plus-circle" aria-hidden="true"></i>
									<span>Create JEE MAINS Tests</span>
								</a>
								<ul class="sub-menu">
									<li><a href="./create_jee_mains_fst.html"> FST Test</a></li>
									<li><a href="./create_jee_mains_cwt.html"> CWT Test</a></li>
									<li><a href="./create_jee_mains_swt.html"> SWT Test</a></li>
								</ul>
							</li>
							<li class="has-sub active">
								<a href="javascript:;">
									<i class="fa fa-plus-circle" aria-hidden="true"></i>
									<span>Create JEE ADVANCED Tests</span>
								</a>
								<ul class="sub-menu">
									<li class="active"><a href="#"> FST Test</a></li>
									<li><a href="./create_jee_advanced_cwt.html"> CWT Test</a></li>
									<li><a href="./create_jee_advanced_swt.html"> SWT Test</a></li>
								</ul>
							</li>
							<li class="has-sub">
								<a href="javascript:;">
									<i class="fa fa-plus-circle" aria-hidden="true"></i>
									<span>Create STATE ENTRANCES Tests</span>
								</a>
								<ul class="sub-menu active">
									<li><a href="./create_state_entrances_fst.html"> FST Test</a></li>
									<li><a href="./create_state_entrances_cwt.html"> CWT Test</a></li>
									<li><a href="./create_state_entrances_swt.html"> SWT Test</a></li>
								</ul>
							</li>
						</ul>
					</li>
					
					<li class="has-sub">
						<a href="javascript:;">
						<i class="fa fa-pencil" aria-hidden="true"></i>
						<span> Modify Tests </span>
						</a>
						<ul class="sub-menu">
							<li><a href="./modify_fst.html">Modify FST Tests</a></li>
							<li><a href="./modify_cwt.html">Modify CWT Tests</a></li>
							<li><a href="./modify_swt.html">Modify SWT Tests</a></li>
						</ul>
					</li>
					<!-- menu 2-->
					<!-- begin sidebar minify button -->
					<li><a href="javascript:;" class="sidebar-minify-btn" data-click="sidebar-minify"><i class="fa fa-angle-double-left"></i></a></li>
					<!-- end sidebar minify button -->
				</ul>
				<!-- end sidebar nav -->
			</div>
			<!-- end sidebar scrollbar -->
		</div>
		<div class="sidebar-bg"></div>
		<!-- end #sidebar -->
		
		<!-- begin #content -->
		<div id="content" class="content">
			<!-- begin breadcrumb -->
			<ol class="breadcrumb pull-right">
                <li class="breadcrumb-item "><a href="#">Create JEE ADVANCED Tests</a></li>
                <li class="breadcrumb-item active"><a href="#">FST</a></li>

			</ol>
			<!-- end breadcrumb -->
			<!-- begin page-header -->
			<h1 class="page-header">Create JEE ADVANCED FST Test</h1>
			<!-- end page-header -->
			
			<!-- begin panel -->
			<div class="panel panel-inverse">
				<div class="panel-heading">
					<div class="panel-heading-btn">
					</div>
					<h4 class="panel-title"></h4>
				</div>
				<div class="panel-body">
					<div class="row">
						<div class="col-md-3">
							<h5><label> Test Name </label></h5>
							<h6><input type="text" id="test_name" placeholder="Enter Name Of Test (Unique)" class="form-control"></h6>
						</div>
						<div class="col-md-3">	
							<h5><label> Duration (in Hours):</label></h5>
							<input type="number" value="1" min=0 class="form-control" id="duration">
						</div>
                        <div class="col-md-12" id="questions_panel">

                        </div>
					</div>
					<br>
                    <div class="row">
                    <button class="btn btn-green add-question-btn" onclick="addQuestion()"><i class="fa fa-plus-circle" aria-hidden="true"></i>
                        ADD QUESTION  </button>
                    <button class="btn btn-danger delete-question-btn" onclick="deleteQuestion()"><i class="fa fa-minus-circle" aria-hidden="true"></i>
						DELETE QUESTION</button>
						<br>
						<button class="btn btn-green create-test-btn" onclick="createTest()"> Create Test </button>
                    </div>
				</div>
			</div>
			<!-- end panel -->
		</div>
		<!-- end #content -->
		
		<!-- begin scroll to top btn -->
		<a href="javascript:;" class="btn btn-icon btn-circle btn-success btn-scroll-to-top fade" data-click="scroll-top"><i class="fa fa-angle-up"></i></a>
		<!-- end scroll to top btn -->
	</div>
	<!-- end page container -->
	
	<!-- ================== BEGIN BASE JS ================== -->
	<script src="../../assets/plugins/jquery/jquery-3.3.1.min.js"></script>
	<script src="../../assets/plugins/jquery-ui/jquery-ui.min.js"></script>
	<script src="../../assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
	<!--[if lt IE 9]>
		<script src="../../assets/crossbrowserjs/html5shiv.js"></script>
		<script src="../../assets/crossbrowserjs/respond.min.js"></script>
		<script src="../../../admin/template../../assets/crossbrowserjs/excanvas.min.js"></script>
	<![endif]-->
	<script src="../../assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
	<script src="../../assets/plugins/js-cookie/js.cookie.js"></script>
	<script src="../../../admin/template../../assets/js/theme/default.min.js"></script>
	<script src="../../assets/js/apps.min.js"></script>
	<!-- ================== END BASE JS ================== -->
	
	<script>
	var pe_username;
	var pe_email;
	var domain_url = "https://photonecademy.com/tests";
	var user_access_token = localStorage.getItem("admin_token");
	var no_of_questions = 0 ;
	var syllabus;
	var jee_advanced_syllabus;
    // TEST Related
    var questions_panel = document.getElementById("questions_panel")
	// All Nameplace holders

		// Sidebar Name Holder
		var sidebarNameHolder = document.getElementById("sidebarNameHolder");
		// Logout functionality
		var logout = document.getElementById("logoutButton");
		logout.addEventListener("click",()=>{
			localStorage.clear();
			document.location.href=`${domain_url}/admin`;

		})
		//Navbar name holder
		var navNameHolder = document.getElementById("navbarNameHolder");
	console.log("access token:-"+user_access_token)
		if(user_access_token==null)
		{
			document.location.href=`${domain_url}/admin`;
		}

		fetch(`${domain_url}/verifyAdmin`,{
			headers:{
				method:"GET",
				authorization:user_access_token
			}
		}).then(response=>response.json()).then(data=>{
			console.log("is token verified? "+data.is_verified);
			if(data.is_verified==false)
			{
				document.location.href=`${domain_url}/admin`;
			}
			if(data.is_verified==true)
			{
				pe_username = data.admin.adminID;
				console.log("The Logged in user is :"+pe_username);
				sidebarNameHolder.innerHTML=pe_username;
				navNameHolder.innerHTML=pe_username;
				fetch(`${domain_url}/getFullSyllabus`,{
					method:"GET",
					headers:{
						authorization:user_access_token
					}
				}).then(response=> response.json()).then(data=>{
					if(data.is_successful)
					{
						syllabus = data.syllabus;
							// Processing Functions
							var subject_selectbox  = document.getElementById("subject_selectbox")
							var chapter_selectbox  = document.getElementById("chapter_selectbox")
							var topic_selectbox  = document.getElementById("topic_selectbox")
							var subjects;
							// Step 1 - Get Syllabus of JEE_ADVANCED
							if(syllabus!=null)
							{
								jee_advanced_syllabus = syllabus.filter((domain)=>{
									return domain.name=="JEE_ADVANCED";
								})

							}
					}
					else
					{
						alert("Failed to fetch Syllabus")
					}
				})
			}
		
		})

        // FST Related Functions
        
            // add Question
            function addQuestion()
            {
                // Increment The Number Of Question
                no_of_questions+=1;
				// Add The Question in the UI
				var question_element = document.createElement('div');
				question_element.setAttribute("id",`question-${no_of_questions}`);
				question_element.setAttribute("class","card");
                question_element.innerHTML=`
                    <div class="card-header">
                         Question ${no_of_questions}
                    </div>
					<div class="card-body" style="height:wrap">
						<div class="row">
						<div class="col-md-6">
                        <h4 style='display:inline-block')">Add / Change Question White Image</h4> : <input type="file" id="question-white-${no_of_questions}-input" name="question-${no_of_questions}-input" onchange="changeQuestionWhiteImage(this,'${no_of_questions}')">
                        <br>
                        <img class="image_panel" style="width:100%;height:200px" id="question-white-${no_of_questions}-image">
						</img>
						</div>
						<div class="col-md-6">
						<h4 style='display:inline-block')">Add / Change Question Black Image</h4> : <input type="file" id="question-black-${no_of_questions}-input" name="question-black-${no_of_questions}-input" onchange="changeQuestionBlackImage(this,'${no_of_questions}')">
						<br>
						<img class="image_panel" style="width:100%;height:200px"id="question-black-${no_of_questions}-image">
                           
						</img>
						</div>
						</div>
						<br>
						<br>
						<div class="row">
						<div class="col-md-6">
                        <h4 style='display:inline-block')">Add / Change Answer White Image</h4> : <input type="file" id="answer-white-${no_of_questions}-input" name="question-${no_of_questions}-input" onchange="changeAnswerWhiteImage(this,'${no_of_questions}')">
                        <br>
                        <img class="image_panel" style="width:100%;height:300px" id="answer-white-${no_of_questions}-image">
						</img>
						</div>
						<div class="col-md-6">
						<h4 style='display:inline-block')">Add / Change Answer Black Image</h4> : <input type="file" id="answer-black-${no_of_questions}-input" name="answer-black-${no_of_questions}-input" onchange="changeAnswerBlackImage(this,'${no_of_questions}')">
						<br>
						<img class="image_panel" style="width:100%;height:300px"id="answer-black-${no_of_questions}-image">
                           
						</img>
						</div>
						</div>
						<br>
						<div class="row" id="question-${no_of_questions}-matrixMatchAnswerArea">

						<br>
						<br>
						<h4><label> Solution Video </label></h4>
						<input class="form-control" id="answer-${no_of_questions}-video" type="text" placeholder=" Enter Solution Video URL">
                    </div>
                    <div class="card-footer text-muted">
					<div class="row">
						<div class="col-2">
							<label> Subject : </label>
							<select class="form-control" onchange="subjectChanged('${no_of_questions}')" id="question-${no_of_questions}-subject_selectbox">
							
							</select>
						</div>
						<div class="col-1">
							<label> Section : </label>
							<select class="form-control" id="question-${no_of_questions}-section_selectbox">
								<option value="Not Specified"> Not Specified </option>
							</select>
						</div>
						<div class="col-3">
							<label> Chapter : </label>
							<select class="form-control" onchange="chapterChanged('${no_of_questions}')" id="question-${no_of_questions}-chapter_selectbox">
							</select>
						</div>
						<div class="col-3">
							<label> Topic : </label>
							<select class="form-control" id="question-${no_of_questions}-topic_selectbox">
							</select>
						</div>
						
						<div class="col-1">
							<label> Difficulty : </label>
							<select class="form-control" id="question-${no_of_questions}-DLevel_selectbox">
							<option value="Level 1"> Level 1 </option>
							<option value="Level 2"> Level 2 </option>
							<option value="Level 3"> Level 3 </option>
							</select>
						</div>
					</div>
					<br>
					<div class="row">
						<div class="col-3">
							<label> Question Type : </label>
							<select class="form-control" onchange="questionTypeChanged('${no_of_questions}')" id="question-${no_of_questions}-question_type">
								<option value="mcq_single"> MCQ Single Option </option>
								<option value="mcq_multiple"> MCQ Multiple Option </option>
								<option value="number"> Number Type </option>
								<option value="match_the_following"> Match The Following Type / Matrix type </option>
							</select>
						</div>
						<div class="col-3" id="question-${no_of_questions}-question_answer_panel">
							<label> Correct Answer : </label>
							<select class="form-control" id="question-${no_of_questions}-question_answer">
								<option value="a"> A </option>
								<option value="b"> B </option>
								<option value="c"> C </option>
								<option value="d"> D </option>
							</select>
						</div>
						<div class="col-3" id="question-${no_of_questions}-question_answer_panel">
							<label> Correct Marks : </label>
							<input type="number" placeholder="Enter Marks for Correct Answer" class="form-control" id="question-${no_of_questions}-correct_marks">
						</div>
						<div class="col-3" id="question-${no_of_questions}-question_answer_panel">
							<label> Wrong Marks : </label>
							<input type="number" placeholder="Enter Marks for Wrong Answer" class="form-control" id="question-${no_of_questions}-wrong_marks">
						</div>
					</div>
				`
				questions_panel.appendChild(question_element)
				var subject_selectbox = document.getElementById(`question-${no_of_questions}-subject_selectbox`);
				var chapter_selectbox = document.getElementById(`question-${no_of_questions}-chapter_selectbox`);
				var topic_selectbox = document.getElementById(`question-${no_of_questions}-topic_selectbox`);
				var section_selectbox = document.getElementById(`question-${no_of_questions}-section_selectbox`);
				// Load Subjects into Subject Selectbox
				jee_advanced_syllabus[0].Subjects.forEach((subject)=>{
					subject_selectbox.innerHTML+=`
					<option value="${subject.name}"> ${subject.name} </option>
					`
				})
				// Load Sections into Section Selectbox
				jee_advanced_syllabus[0].Subjects[0].Sections.forEach(section=>{
					section_selectbox.innerHTML+=`
					<option value="${section.name}"> ${section.name} </option>
				})`
			})
				// Load Chapters Select box of First Subject
				chapter_selectbox.innerHTML=`<option value="Not Specified"> Not Specified </option>`;
				jee_advanced_syllabus[0].Subjects[0].Chapters.forEach(chapter=>{
					chapter_selectbox.innerHTML+=`<option value="${chapter.name}"> ${chapter.name} </option>`;
				})
				topic_selectbox.innerHTML='<option value="Not Specified"> Not Specified </option>';
            }

			// Change Question 
			function changeQuestionWhiteImage(input,question_number)
			{
				var question_image_panel = document.getElementById(`question-white-${question_number}-image`);
				var question_image = input.files[0];
				question_image_panel.src = URL.createObjectURL(question_image)
			}
			function changeQuestionBlackImage(input,question_number)
			{
				var question_image_panel = document.getElementById(`question-black-${question_number}-image`);
				var question_image = input.files[0];
				question_image_panel.src = URL.createObjectURL(question_image)
			}
		
			// Change Answer Image
			function changeAnswerWhiteImage(input,question_number)
			{
				var answer_image_panel = document.getElementById(`answer-white-${question_number}-image`);
				var answer_image = input.files[0];
				answer_image_panel.src = URL.createObjectURL(answer_image)
			}

			function changeAnswerBlackImage(input,question_number)
			{
				var answer_image_panel = document.getElementById(`answer-black-${question_number}-image`);
				var answer_image = input.files[0];
				answer_image_panel.src = URL.createObjectURL(answer_image)
			}
			// Delete Question
			function deleteQuestion()
			{
				document.getElementById(`question-${no_of_questions}`).remove()
				no_of_questions=no_of_questions-1;
			}
			// on Subject Change
			function subjectChanged(question_number)
			{
				var subject = document.getElementById(`question-${question_number}-subject_selectbox`).value;
				console.log(subject);
				var subject_object = jee_advanced_syllabus[0].Subjects.filter((sub)=>{
					return sub.name==subject;
				})
				var chapters_selectbox = document.getElementById(`question-${question_number}-chapter_selectbox`);
				chapters_selectbox.innerHTML=`
					<option value="Not Specified"> Not Specified </option>
					`
				subject_object[0].Chapters.forEach(chapter=>{
					chapters_selectbox.innerHTML+=`
					<option value="${chapter.name}"> ${chapter.name} </option>
					`
				})	
				var topic_selectbox = document.getElementById(`question-${question_number}-topic_selectbox`);
				topic_selectbox.innerHTML='<option value="Not Specified"> Not Specified </option>';
				var section_selectbox = document.getElementById(`question-${question_number}-section_selectbox`);
				section_selectbox.innerHTML=`<option value="Not Specified"> Not Specified </option>`;
				
				subject_object[0].Sections.forEach(section=>{
					section_selectbox.innerHTML+=`<option value="${section.name}"> ${section.name}</option>`;
				})
			}
			// on Chapter Change
			function chapterChanged(question_number)
			{
				var chapter = document.getElementById(`question-${question_number}-chapter_selectbox`).value;
				var subject_name = document.getElementById(`question-${question_number}-subject_selectbox`).value;
				console.log(chapter);
				var subject_object = jee_advanced_syllabus[0].Subjects.filter((sub)=>{
					return sub.name==subject_name;
				})
				var topic_selectbox = document.getElementById(`question-${question_number}-topic_selectbox`);
				if(chapter!="Not Specified")
				{
					var topics = subject_object[0].Topics.filter((topic)=>{
						return topic.chapter == chapter;
					})
					topic_selectbox.innerHTML=`<option value="Not Specified"> Not Specified </option>`;
					topics.forEach((topic)=>{
						topic_selectbox.innerHTML+=`
						<option value="${topic.name}"> ${topic.name} </option>
						`
					})

				}
			
			}
			// Create FST
			function createTest(){
				var error=0;

				//  Get Test Version 
				var test_name = document.getElementById("test_name").value;
				if(test_name=="")
				{
					error=1;
					alert("Please Enter A Valid Test Name")
				}

				// Get Duration
				var duration = document.getElementById("duration").value
				if(duration==null || duration=="")
				{
					alert("Please Enter Test duration")
					error=1;
				}
				// Get Total Number of questions
				var questions_count = no_of_questions;
				// Parse Each Question & Make Question Object
				if(questions_count==0)
				{
					error=1;
					alert("Please Enter Atleast 1 question");
				}
				

				//*************************************** REQUIRED FOR STATISTICS ***********************************/
				var subjects_array = [];
				var sections_array = [];
				var chapters_array = [];
				var topics_array = [];
				// Initialize Questions Array 
				
				// Preprocessing to find all the types of subjects, sections, chapters, topics
				var all_preprocessed = false;
				for(i=1;i<=no_of_questions;i++)
				{
					var question_subject = document.getElementById(`question-${i}-subject_selectbox`).value;
					var question_section = document.getElementById(`question-${i}-section_selectbox`).value;
					var question_chapter = document.getElementById(`question-${i}-chapter_selectbox`).value;
					var question_topic = document.getElementById(`question-${i}-topic_selectbox`).value;
					if(question_subject!=null && question_subject!="" && question_chapter!=null && question_chapter!="" && question_section!=null && question_section!="" && question_topic!=null && question_topic!="")					{
					subjects_array.push(question_subject);
					sections_array.push(question_section);
					chapters_array.push(question_chapter);
					topics_array.push(question_topic);
					}
					else
					{
						error=1;
					}
					if(i==no_of_questions)
					{
						all_preprocessed=true
					}
				}
				if(all_preprocessed)  // All Questions have been preprocessed
				{
					var subjects_set = [...new Set(subjects_array)]
					var sections_set = [...new Set(sections_array)]
					var chapters_set = [...new Set(chapters_array)]
					var topics_set = [...new Set(topics_array)]
					var subjects_count = [];
					subjects_set.forEach(subject=>{ // Add Counters
						subjects_count.push(0);
					})
					var sections_count = [];
					sections_set.forEach(section=>{
						sections_count.push(0);
					})
					var chapters_count = [];
					chapters_set.forEach(chapter=>{
						chapters_count.push(0);
					})
					var topics_count = [];
					topics_set.forEach(topic=>{
						topics_count.push(0);
					})
					

					// Structuring of Schema
					var questions=[]
					var answer_images_white=[];
					var answer_images_black=[];
					var questions_images_white=[];
					var questions_images_black=[];
					var answer_videos=[];
					var answer_key=[];
					var Dlevel1_count=0;
					var Dlevel2_count=0;
					var Dlevel3_count=0;
		
							var all_parsed=false;
							if(error==0)
							{
							for(i=1;i<=no_of_questions;i++)
							{
								if(i==no_of_questions)
								{
									all_parsed=true;
								}
								// Get Question Subject,Chapter and Topic
								
								var question_subject = document.getElementById(`question-${i}-subject_selectbox`).value;
								// Increment the counter of that subject;
								for(let i=0;i<subjects_set.length;i++)
								{
									if(question_subject==subjects_set[i])
									{
										subjects_count[i]+=1;
									}
								}

								var question_section = document.getElementById(`question-${i}-section_selectbox`).value;
								// Increment the counter of that section
								for(let i=0;i<sections_set.length;i++)
								{
									if(question_section==sections_set[i])
									{
										sections_count[i]+=1;
									}
								}

								var question_chapter = document.getElementById(`question-${i}-chapter_selectbox`).value;
								// Increment the counter of that chapter
								for(let i=0;i<chapters_set.length;i++)
								{
									if(question_chapter==chapters_set[i])
									{
										chapters_count[i]+=1;
									}
								}

								var question_topic = document.getElementById(`question-${i}-topic_selectbox`).value;
								// Increment the counter of that topic
								for(let i=0;i<topics_set.length;i++)
								{
									if(question_topic==topics_set[i])
									{
										topics_count[i]+=1;
									}
								}

							
								// Get Question Type
								var question_type = document.getElementById(`question-${i}-question_type`).value
								// Get Question Difficulty Level 
								var question_DLevel = document.getElementById(`question-${i}-DLevel_selectbox`).value;
								// Get Question Correct And Wrong Answers
								var question_correct_marks = document.getElementById(`question-${i}-correct_marks`).value;
								var question_wrong_marks = document.getElementById(`question-${i}-wrong_marks`).value;
								// Update Counter
									if(question_DLevel=="Level 1")
									{
										Dlevel1_count++;
									}
									if(question_DLevel=="Level 2")
									{
										Dlevel2_count++;
									}
									if(question_DLevel=="Level 3")
									{
										Dlevel3_count++;
									}

								// Get Correct Answer
								if(question_type=="mcq_single" || question_type=="mcq_multiple" )
								{
								var correct_answer = $(`#question-${i}-question_answer`).val();
								console.log(correct_answer);
								 //	error=1 Just for testing
								}
								else if(question_type=="number")
								{
									var correct_answer= document.getElementById(`question-${i}-question_answer`).value;
								}
								else if(question_type=="match_the_following")
								{
									var correct_answer=[];
									// First get the number of options
									var no_of_options = document.getElementById(`question-${i}-number_of_options`).value;
									console.log(`No. of options is ${no_of_options}`)
									for(let j=1;j<=no_of_options;j++)
									{
										var option = document.getElementById(`question-${i}-option${j}`).value;
										correct_answer.push(option)
									}
								// 	error=1 Just for testing
									console.log(correct_answer)
									
								}
								answer_key.push(correct_answer);
								// Get Question Image
								var question_white_image = document.getElementById(`question-white-${i}-input`).files[0];
								questions_images_white.push(question_white_image);	
								var question_black_image = document.getElementById(`question-black-${i}-input`).files[0];
								questions_images_black.push(question_black_image);
								// Get Answer Image
								var answer_white_image = document.getElementById(`answer-white-${i}-input`).files[0];
								answer_images_white.push(answer_white_image); // Push it in white images array
								var answer_black_image = document.getElementById(`answer-black-${i}-input`).files[0];
								answer_images_black.push(answer_black_image); // Push it in black images array
								// Get Answer Video Solution
								var answer_video = document.getElementById(`answer-${i}-video`).value;
								answer_videos.push(answer_video);
								if(question_white_image==null || question_white_image=="" || answer_black_image==null || answer_black_image=="")
								{
									alert("Make sure you have attached images for all questions and their answers");
									error=1;
								}
								if(answer_video==null || answer_video=="")
								{
									alert("Make sure to enter video solution url");
									error=1;
								}
								if(error==0)
								{
								// Create The Question Object
								var Question = {"subject":question_subject,
												"section":question_section,
												"chapter":question_chapter,
												"topic":question_topic,
												"correct_marks":question_correct_marks,
												"wrong_marks":question_wrong_marks,		
												"question_type":question_type,
												"DLevel":question_DLevel}
								questions.push(Question);
								}
							}
						}
							// IF all questions are parsed
							if(all_parsed)
							{
								if(error==0)
								{
									subject_details = {subjects:subjects_set,subjects_question_count:subjects_count};
									section_details = {sections:sections_set,sections_question_count:sections_count};
									chapter_details = {chapters:chapters_set,chapters_question_count:chapters_count};
									topic_details = {topics:topics_set,topics_question_count:topics_count};
									var DLevel_Details = { 
											"DLevel1_count":Dlevel1_count,
											"DLevel2_count":Dlevel2_count,
											"DLevel3_count":Dlevel3_count
										}
									// Create The Test Object (Important)
									var formData = new FormData();
									formData.append('test_name',test_name);
									formData.append('test_type',"FST");
									formData.append('domain',"JEE_ADVANCED");
									formData.append('duration',duration);
									formData.append('questions',JSON.stringify(questions));
									formData.append(`answer_videos`,JSON.stringify(answer_videos));
									formData.append(`answer_key`,JSON.stringify(answer_key));
									formData.append(`DLevel_details`,JSON.stringify(DLevel_Details));
									formData.append(`no_of_answerWhiteImages`,answer_images_white.length);
									formData.append(`no_of_answerBlackImages`,answer_images_black.length);
									formData.append(`no_of_questionWhiteImages`,questions_images_white.length);
									formData.append(`no_of_questionBlackImages`,questions_images_black.length);
									formData.append(`subject_details`,JSON.stringify(subject_details));
									formData.append(`section_details`,JSON.stringify(section_details));
									formData.append(`chapter_details`,JSON.stringify(chapter_details));
									formData.append(`topic_details`,JSON.stringify(topic_details));
									// Load Answers in form Data
									for(let i=0;i<answer_images_white.length;i++)
									{
										formData.append(`uploadedFiles`,answer_images_white[i],`answerWhite`);
									}
									for(let i=0;i<answer_images_black.length;i++)
									{
										formData.append(`uploadedFiles`,answer_images_black[i],`answerBlack`);
									}
									// Load Questions in form Data
									for(let i=0;i<questions_images_white.length;i++)
									{
										formData.append(`uploadedFiles`,questions_images_white[i],`questionWhite`);
									}	
									for(let i=0;i<questions_images_black.length;i++)
									{
										formData.append(`uploadedFiles`,questions_images_black[i],`questionBlack`);
									}
									
									let h = new Headers();
									h.append('authorization',user_access_token);
									h.append('Accept','application/json');
									let req = new Request(`${domain_url}/createFST`,{
										method:"POST",
										headers:h,
										body:formData
									})
									
									fetch(req).then(response=> response.json()).then(data=>{
										if(data.is_successful)
										{
											alert("Test Submitted");
										}
										else
										{
											alert("failed to submit test");
										}
									})
								}
							}
				}
				
			}


		function questionTypeChanged(question_number)
		{
			var questionType = document.getElementById(`question-${question_number}-question_type`).value;
			console.log(`Question Type is ${questionType}`)
			var questionAnswerPanel = document.getElementById(`question-${question_number}-question_answer_panel`)
			if(questionType=="mcq_multiple")
			{
				questionAnswerPanel.innerHTML=`
				<label> Correct Answer : </label>
							<select class="form-control" multiple="mutiple" id="question-${no_of_questions}-question_answer">
								<option value="a"> A </option>
								<option value="b"> B </option>
								<option value="c"> C </option>
								<option value="d"> D </option>
							</select>
				`
			}
			else if(questionType=="mcq_single")
			{
				questionAnswerPanel.innerHTML=`
				<label> Correct Answer : </label>
							<select class="form-control" id="question-${no_of_questions}-question_answer">
								<option value="a"> A </option>
								<option value="b"> B </option>
								<option value="c"> C </option>
								<option value="d"> D </option>
							</select>
				`	
			}
			else if(questionType=="number")
			{
				questionAnswerPanel.innerHTML=`
				<label> Correct Answer : </label>
				<input type="number" class="form-control" id="question-${no_of_questions}-question_answer">	
				`	
			}
			else if(questionType="match_the_following")
			{
				questionAnswerPanel.setAttribute("class","col-9");
				questionAnswerPanel.innerHTML=`
				<div class="col-2">
					<label> No. of Options </label>
					<input type="number" class="form-control" onchange="noOfOptionsChanged('${no_of_questions}')" id="question-${no_of_questions}-number_of_options">	
				</div>
			
				`
			}

		}

		function noOfOptionsChanged(question_number)
		{
			var questionAnswerPanel = document.getElementById(`question-${question_number}-question_answer_panel`)
			var noOfOptions = document.getElementById(`question-${question_number}-number_of_options`).value;
			document.getElementById(`question-${question_number}-number_of_options`).setAttribute("value",noOfOptions);
			document.getElementById(`question-${question_number}-number_of_options`).disabled="disabled"
			for(let i=1;i<=noOfOptions;i++)
			{
				questionAnswerPanel.innerHTML+=`
			<div class="col-2">
					<label> Option ${i} </label>
					<input type="text" class="form-control")" id="question-${question_number}-option${i}">	
				</div>
			`
			}
		
		}
		$(document).ready(function() {
			App.init();
		});
	</script>
</body>
</html>
