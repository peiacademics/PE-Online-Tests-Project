<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title id="result-title">Result</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <!-- PATTERN FLY -->
</head>
<body>
<nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand" id="test_title_navbar" href="#">(Test_name)</a>
        <a class="navbar-brand" href="#" style="float:right" id="student_marks_navbar"> [Marks] </a>
</nav>   
<div class="container">
    <table id="resultDataTable" class="display" style="width:100%">
    
    </table>
</div>
<script>
var pe_username;
var pe_email;
var result;
var user_access_token = localStorage.getItem("student_token");
var domain_url = "https://photonecademy.com/tests"
// Related to this page
var test_title_navbar = document.getElementById("test_title_navbar");
var student_marks_navbar = document.getElementById("student_marks_navbar");
var resultDataTable = document.getElementById(`resultDataTable`)
var data_table_header_content = `
<thead>
    <tr> 
        <th> Sr No. </th>
        <th> Q No </th>
        <th> Your Answer </th>
        <th> Marks Scored </th>
        <th> DLevel </th>
        <th> Subject </th>
        <th> Section </th>
        <th> Chapter </th>
        <th> Topic </th>
        <th> % Correct </th>
        <th> % Wrong </th>
        <th> % Unattempted </th>
    </tr>
</thead>
<tbody>
`
var data_table_content=``;

var data_table_fotter_content = `
</tbody>
<tfoot>
            <tr>
                    <th> Sr No. </th>
                    <th> Q No </th>
                    <th> Your Answer </th>
                    <th> Marks Scored </th>
                    <th> DLevel </th>
                    <th> Subject </th>
                    <th> Section </th>
                    <th> Chapter </th>
                    <th> Topic </th>
                    <th> % Correct </th>
                    <th> % Wrong </th>
                    <th> % Unattempted </th>
            </tr>
</tfoot>
`

function getUrlParameter(name) {
    name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
    var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
    var results = regex.exec(location.search);
    return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
};
var test_name = getUrlParameter('test_name');

fetch(`${domain_url}/verifyStudent`,{
			headers:{
				method:"GET",
				authorization:user_access_token
			}
		}).then(response=>response.json()).then(data=>{
			console.log("is token verified? "+data.is_verified);
			if(data.is_verified==false)
			{
				document.location.href=`${domain_url}`;
			}
			if(data.is_verified==true)
			{
				console.log(data);
				var authDetails = data.student;
				pe_username = authDetails.studentID;
				console.log(` Test Name is ${test_name} and StudentID is ${pe_username}`)
                fetch(`${domain_url}/getSpecificTestResult`,{
                    method:"POST",
                    headers:{
                        authorization:user_access_token,
                        'Content-type':'application/json'
                    },
                    body:JSON.stringify({studentID:pe_username,test_name:test_name})
                }).then(res=>res.json()).then(output=>{
                    console.log(output)
                    if(output.is_successful)
                    {
                        test_title_navbar.innerHTML=test_name;
                        var t_marks = output.result.test_correct_marks * output.result.answers.length;
                        var score = `Your Score : ${output.result.total_marks} / ${t_marks}`
                        student_marks_navbar.innerHTML=score;
                        resultDataTable.innerHTML=data_table_header_content+data_table_content+data_table_fotter_content;
                        $(`#resultDataTable`).DataTable();
                    }
                    else
                    {
                        alert("Failed to get result")
                    }
                })
			}
		})

</script>
</body>
</html>